#!/usr/bin/make -f
# -*- makefile -*-


#export DH_VERBOSE=1
export DH_ALWAYS_EXCLUDE="CVS:.svn"

export DEB_HOST_GNU_TYPE  ?= $(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)
export DEB_BUILD_GNU_TYPE ?= $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)

CONFIGURE_FLAGS = --build $(DEB_BUILD_GNU_TYPE) --host $(DEB_HOST_GNU_TYPE)


build:
	test -x autogen.sh && ./autogen.sh
	dh build --with autotools_dev --before auto_configure
	dh_auto_configure  -- --disable-static --enable-gtk-doc $(CONFIGURE_FLAGS)
	dh build --after auto_configure

clean:
	# Hack! Because GTK-Doc is bloody retarded!
	rm -f docs/reference/libmirage/html/*.html

	dh clean --with autotools_dev

install: build
	dh install

binary-indep: install
	dh binary-indep

binary-arch: install
	dh binary-arch --before strip
	dh_strip --dbg-package=libmirage3-dbg
	dh binary-arch --after strip --before makeshlibs
	dh_makeshlibs --exclude="libmirage-1.4"
	dh_shlibdeps --exclude="libmirage-1.4"
	dh binary-arch --after shlibdeps

binary: binary-indep binary-arch

.PHONY: build clean install binary-indep binary-arch binary

